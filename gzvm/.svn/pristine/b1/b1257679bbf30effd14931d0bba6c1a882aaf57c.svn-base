<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd"
	default-autowire="byName" default-lazy-init="false">
	<bean id="propertyConfigurer"  class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <!-- 
        <property name="location">
            <value>classpath:gebile.properties</value>
        </property>
        -->
        <property name="locations">
            <list>
            	<!-- <value>classpath:config/gebile.properties</value> -->
                <value>file:${VOGE_HOME}/config/gzvm/jdbc.properties</value>
                <value>file:${VOGE_HOME}/config/gzvm/param.properties</value>
            </list>
		</property> 
		<property name="systemPropertiesMode">  
            <value>1</value>  
        </property>  
        <property name="searchSystemEnvironment">  
            <value>true</value>  
        </property>  
        <property name="ignoreUnresolvablePlaceholders">  
            <value>true</value>  
        </property>  
	</bean>
	<!-- 
	<bean id="dataSource"
        class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="url">
            <value>${database.url}</value>
        </property>
        <property name="driverClassName">
            <value>${database.driver}</value>
        </property>
        <property name="username">
            <value>${database.user}</value>
        </property>
        <property name="password">
            <value>${database.password}</value>
        </property>
	</bean>
 	
 	<bean id="appConfig" class="cn.com.voge.sys.config.AppConfig">
		<property name="appProperties" ref="appProperties"/>
	</bean>

	<bean id="propertyConfigurer" class="cn.com.voge.core.config.AppPropertyPlaceholderConfigurer">
		<constructor-arg type="org.jasypt.encryption.StringEncryptor" ref="stringEncryptor"/>
		<property name="appProperties" ref="appProperties"/>
	</bean>
	-->
	<aop:aspectj-autoproxy/>
	<aop:config proxy-target-class="true">
		<aop:advisor pointcut="execution(* cn.com.voge..schedule.*Schedule.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..service.*Service.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..service.support.*Service.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..dao.*Dao.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..dao.impl.*Impl.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..dao.ibatis.*Dao.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..manager.*Manager.*(..))" advice-ref="txAdvice"/>
		
		<aop:advisor pointcut="execution(* cn.com.voge..dmi.*DMI.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..dmi.datasource.*DMI.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..action.*Action.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..action.routine.*Action.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge..action.scheme.*Action.*(..))" advice-ref="txAdvice"/>
		<aop:advisor pointcut="execution(* cn.com.voge.core.dao.sequence.*Sequence.*(..))" advice-ref="txAdviceSequence"/>
		
	</aop:config>

	<tx:advice id="txAdvice" transaction-manager="txManager">
		<tx:attributes>
			<tx:method name="save*" propagation="REQUIRED"/>
			<tx:method name="create*" propagation="REQUIRED"/>
			<tx:method name="add*" propagation="REQUIRED"/>
			<tx:method name="insert*" propagation="REQUIRED"/>
			<tx:method name="update*" propagation="REQUIRED"/>
			<tx:method name="remove*" propagation="REQUIRED"/>
			<tx:method name="delete*" propagation="REQUIRED"/>
			<tx:method name="del*" propagation="REQUIRED"/>
			<tx:method name="change*" propagation="REQUIRED"/>
			<tx:method name="modify*" propagation="REQUIRED"/>
			<tx:method name="gen*" propagation="REQUIRED"/>
			<tx:method name="publish*" propagation="REQUIRED"/>
			<tx:method name="export*" propagation="REQUIRED"/>
			<tx:method name="assign*" propagation="REQUIRED"/>
			<tx:method name="copy*" propagation="REQUIRED"/>
			<tx:method name="move*" propagation="REQUIRED"/>
			<tx:method name="write*" propagation="REQUIRED"/>
			<tx:method name="*" read-only="false" no-rollback-for="java.lang.Throwable"/>
		</tx:attributes>
	</tx:advice>

	<tx:advice id="txAdviceDMI" transaction-manager="txManager">
		<tx:attributes>
			<tx:method name="*" read-only="false" no-rollback-for="java.lang.Throwable"/>
		</tx:attributes>
	</tx:advice>

	<tx:advice id="txAdviceReadOnly" transaction-manager="txManager">
		<tx:attributes>
			<tx:method name="*" read-only="true" no-rollback-for="java.lang.Throwable"/>
		</tx:attributes>
	</tx:advice>

	<tx:advice id="txAdviceNew" transaction-manager="txManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRES_NEW"/>
		</tx:attributes>
	</tx:advice>

	<tx:advice id="txAdviceSequence" transaction-manager="txManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRES_NEW"/>
		</tx:attributes>
	</tx:advice> 
</beans>